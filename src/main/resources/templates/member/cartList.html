<html xmlns:th="http://www.thymeleaf.org">
<!-- header replace -->
<div th:replace="~{ /fragments/header.html :: header }"></div>
<div th:replace="~{ /fragments/subMenu.html :: subMenu }"></div>
<head>
	<title>All it - I have a All it</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>

<body th:align="center">
<h1>장바구니</h1>
<article style="margin-bottom: 20px">
	<form name="formm" id="theform" method="post">
		<h3 th:if="${cartList.size() == 0}" style="color: red; text-align: center;">장바구니가 비었습니다.</h3>
		<th:block th:unless="${cartList.size() == 0}">
			<table id="cartList" border="1" align="center">
				<tr>
					<th>상품명</th>
					<th>수 량</th>
					<th>가 격</th>
					<th>삭 제</th>
				</tr>
				<th:block th:each="cart : ${cartList}">
				<tr th:each="prod : ${prodList}">
					<td><a th:href="@{ |/product/detail/${ prod.pno }| }">
							<h3 th:text="${prod.name}"></h3>
					</a></td>
					<td th:text="${cart.quantity}"></td>
					<td th:text="${#numbers.formatInteger((prod.price*cart.quantity), 1, 'COMMA')}">원</td>
					<td><input type="checkbox" name="cno" id="cno" th:value="${cart.cno}"></td>
				</tr>
				</th:block>
				<tr>
					<th>총 액</th>
					<th colspan="2" th:text="${#numbers.formatInteger(totalPrice, 1, 'COMMA')}">원</th>
					<th><a href="#" onclick="go_cart_delete()" class="btn btn-light"><h3>삭제하기</h3></a></th>
				</tr>
			</table>
		</th:block>
		<div class="clear"></div>
		<div id="buttons" style="float: right">
			<input type="button" value="쇼핑 계속하기" class="btn btn-light" onclick="location.href='index'">
			<input th:if="${cartList.size() != 0}" type="button" value="주문하기" class="btn btn-light" onclick="go_order_insert()">
		</div>
	</form>
</article>

<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script type="text/javascript">
	// 비밀번호 확인
	$("#pwdCheck").focusout(function(){
    	var pass1 = $("#pwd").val();
        var pass2 = $("#pwdCheck").val();
        
        if (pass1 != "" || pass2 != ""){
        	if (pass1 == pass2){
            	$("#checkPw").html('비밀번호가 일치합니다.');
            	$("#checkPw").attr('color','green');
            } else {
            	$("#checkPw").html('비밀번호가 일치하지 않습니다. 다시 입력해주세요.');
                $("#checkPw").attr('color','red');
            }
        } else {
        	$("#checkPw").html('비밀번호를 입력해주세요.');
            $("#checkPw").attr('color','red');
        }
    });
	
	
	// 회원 정보수정
	$("#modBtn").click(function(){
		var pass1 = $("#pwd").val();
        var pass2 = $("#pwdCheck").val();
        
        if(pass1 != "" || pass2 != ""){
	        if(pass1 != pass2) {
	        	alert("비밀번호를 확인해주세요.");
	        	return false;
	        } else {
				var modCheck = window.confirm("이대로 정보를 수정하시겠습니까?");
				
				if(modCheck) {
					$("#frm").submit();
				} else {
					return false;
				}
	        }
        } else {
        	alert("비밀번호를 입력해주세요.");
        }
	});
	
	// 회원 탈퇴
	$("#delBtn").click(function(){
		var pass1 = $("#pwd").val();
        var pass2 = $("#pwdCheck").val();
        
        if(pass1 != "" || pass2 != ""){
	        if(pass1 != pass2) {
	        	alert("비밀번호를 확인해주세요.");
	        	return false;
	        } else {
	        	var delCheck = window.confirm("정말 탈퇴하시겠습니까? \n탈퇴하시면 모든 정보는 삭제됩니다.");
	    		
	    		if(delCheck) {
	    			$("#frm").submit();
	    		} else {
	    			return false;
	    		}
	        }
        } else {
        	alert("비밀번호를 입력해주세요.");
        }
		
		/*
		var userid = $("#userId").val();
		var delCheck = window.confirm("정말 탈퇴하시겠습니까? \n탈퇴하시면 모든 정보는 삭제됩니다.");
		
		if(delCheck) {
			$.ajax({
				url : "/member/userDel",
				type : "post",
				// async : false,	// 이렇게 설정하면 비동기가 아닌 동기식으로 처리
				data : {userId: userid},
				dataType : 'json',
				success : function(result){
					alert(userid+"님 탈퇴 처리 되었습니다.");
				},
				error : function(){
					alert("서버 요청 실패");
				}
			});
		}
		*/
	});
</script>
</body>

<!-- footer replace -->
<div th:replace="~{ /fragments/footer.html :: footer }"></div>
